# ü§ñ LawBot ‚Äî AI Assistant for Legal Documents (StuPro)

LawBot ‚Äî —ç—Ç–æ —É–º–Ω—ã–π WhatsApp-–±–æ—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Å–±–æ—Ä–∞, –∞–Ω–∞–ª–∏–∑–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ (–¥–ª—è –ú–í–î/–°—Ç—É–ü–†–û). –ë–æ—Ç –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ñ–æ—Ç–æ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤, –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ —Å–∫–∞–Ω–∏—Ä—É–µ—Ç –∏—Ö, –∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—é, –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –≤ PDF –∏ —Ä–∞—Å–∫–ª–∞–¥—ã–≤–∞–µ—Ç –ø–æ –ø–∞–ø–∫–∞–º –≤ –æ–±–ª–∞–∫–µ.

## üöÄ –û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

* **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å WhatsApp:** –ü—Ä–∏–µ–º —Ñ–∞–π–ª–æ–≤ –∏ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ Twilio API.
* **Google Cloud Vision (OCR):**
    * **–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–≤–æ—Ä–æ—Ç:** –¢–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —É–≥–ª–∞ —Ç–µ–∫—Å—Ç–∞ (–≤–ø–ª–æ—Ç—å –¥–æ –≥—Ä–∞–¥—É—Å–∞) –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–æ–≤–æ—Ä–æ—Ç.
    * **Smart Crop (–£–º–Ω–∞—è –æ–±—Ä–µ–∑–∫–∞):** –î–µ—Ç–µ–∫—Ü–∏—è –≥—Ä–∞–Ω–∏—Ü –¥–æ–∫—É–º–µ–Ω—Ç–∞ —Å "–∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É—Ä–∞–∫–∞" (–Ω–µ –æ–±—Ä–µ–∑–∞–µ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –¥–æ —Ä–∞–∑–º–µ—Ä–∞ —à—Ç–∞–º–ø–∞).
    * **–†–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞:** –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞ (–∏–≤—Ä–∏—Ç/—Ä—É—Å—Å–∫–∏–π/–∞–Ω–≥–ª–∏–π—Å–∫–∏–π) –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞.
* **–ò–ò-–∞–Ω–∞–ª–∏–∑ (–ì–∏–±—Ä–∏–¥–Ω—ã–π –º–µ—Ç–æ–¥):**
    * –ò—Å–ø–æ–ª—å–∑—É–µ—Ç **OCR-—Ç–µ–∫—Å—Ç** –≤–º–µ—Å—Ç–æ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ OpenAI.
    * **–û–±—Ö–æ–¥ Privacy Filters:** –ü–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Å–ø–æ—Ä—Ç–∞ –∏ ID, –Ω–µ –≤—ã–∑—ã–≤–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ OpenAI.
    * –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ç–∏–ø–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞ (30+ —Ç–∏–ø–æ–≤ –¥–ª—è –°—Ç—É–ü–†–û) –∏ –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –∏–º–µ–Ω–∏.
* **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
    * –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –ª—é–±—ã—Ö —Ñ–æ—Ç–æ –≤ PDF.
    * –£–ª—É—á—à–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ –∏ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ (Enhance).
    * –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ **–æ—Ä–∏–≥–∏–Ω–∞–ª–æ–≤** (`_orig`) –∏ **—á–∏—Å—Ç–æ–≤–∏–∫–æ–≤** (PDF).
* **–û–±–ª–∞—á–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ:**
    * **Production:** Yandex Disk.
    * **Test:** Dropbox (–≤–µ—Ç–∫–∞ develop).
* **CI/CD:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π —á–µ—Ä–µ–∑ GitHub Actions —Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º –∫–ª—é—á–∞–º–∏.

---

## üõ† –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

* **–Ø–∑—ã–∫:** Python 3.11
* **–§—Ä–µ–π–º–≤–æ—Ä–∫:** FastAPI (Webhooks)
* **OCR & Vision:** Google Cloud Vision API
* **AI Analysis:** OpenAI API (GPT-4o / GPT-4o-mini)
* **–ú–µ—Å—Å–µ–Ω–¥–∂–µ—Ä:** Twilio WhatsApp API
* **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** SQLite + SQLModel
* **–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞:** Docker & Docker Compose
* **–°–µ—Ä–≤–µ—Ä:** Linux (CentOS/Ubuntu)

---

## üìÇ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
LawBot/
‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞, –≤–µ–±—Ö—É–∫–∏ WhatsApp
‚îú‚îÄ‚îÄ database.py             # –ú–æ–¥–µ–ª–∏ –ë–î (Client, Document)
‚îú‚îÄ‚îÄ google_credentials.json # –ö–ª—é—á Google (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è –≤ CI/CD, –≤ git –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç—Å—è!)
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ doc_processor.py    # –õ–æ–≥–∏–∫–∞: Google Vision (—É–≥–æ–ª, –∫—Ä–æ–ø, OCR) + ImageMagick
‚îÇ   ‚îú‚îÄ‚îÄ openai_client.py    # –ö–ª–∏–µ–Ω—Ç OpenAI (–ø—Ä–∏–Ω–∏–º–∞–µ—Ç —Ç–µ–∫—Å—Ç –∏–ª–∏ —Ñ–æ—Ç–æ)
‚îÇ   ‚îî‚îÄ‚îÄ yandex_disk.py      # –†–∞–±–æ—Ç–∞ —Å –æ–±–ª–∞–∫–∞–º–∏ (Yandex/Dropbox)
‚îú‚îÄ‚îÄ temp_files/             # –í—Ä–µ–º–µ–Ω–Ω–∞—è –ø–∞–ø–∫–∞ (–∞–≤—Ç–æ-–æ—á–∏—Å—Ç–∫–∞)
‚îú‚îÄ‚îÄ docker-compose.yml      # –ü—Ä–æ–¥
‚îú‚îÄ‚îÄ docker-compose.test.yml # –¢–µ—Å—Ç
‚îî‚îÄ‚îÄ .github/workflows/      # CI/CD –ø–∞–π–ø–ª–∞–π–Ω—ã

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
1. –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (.env)
–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª .env (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞) –∏–ª–∏ .env.test:

# --- –û—Å–Ω–æ–≤–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ---
SECRET_KEY=super_secret_key_change_me
ADMIN_USERNAME=admin
ADMIN_PASSWORD_HASH=—à–∞256_—Ö–µ—à

# --- API –ö–ª—é—á–∏ ---
OPENAI_API_KEY=sk-proj-...
TWILIO_ACCOUNT_SID=AC...
TWILIO_AUTH_TOKEN=...

# --- Google Vision (–ü—É—Ç—å –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞) ---
GOOGLE_APPLICATION_CREDENTIALS=/app/google_credentials.json

# --- –û–±–ª–∞–∫–æ (–í—ã–±—Ä–∞—Ç—å –æ–¥–Ω–æ) ---
STORAGE_PROVIDER=yandex
YANDEX_DISK_TOKEN=y0_...
# STORAGE_PROVIDER=dropbox
# DROPBOX_TOKEN=sl...

2. –ö–ª—é—á Google Cloud
–§–∞–π–ª google_credentials.json –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –ø–æ–ª–æ–∂–∏—Ç–µ –µ–≥–æ –≤ –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞. –î–ª—è CI/CD –æ–Ω –∑–∞–∫–æ–¥–∏—Ä–æ–≤–∞–Ω –≤ Base64 –∏ –ª–µ–∂–∏—Ç –≤ GitHub Secrets (GOOGLE_CREDENTIALS_BASE64).

3. –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker
Production (–ø–æ—Ä—Ç 8001):
docker-compose up -d --build

Test (–ø–æ—Ä—Ç 8002):
docker-compose -f docker-compose.test.yml --env-file .env.test up -d --build

## üß† –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã (Pipeline)
–í—Ö–æ–¥: –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–æ—Ç–æ –≤ WhatsApp.

Google Vision Analysis:

API –ø–æ–ª—É—á–∞–µ—Ç –∫–∞—Ä—Ç–∏–Ω–∫—É.

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç —É–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ —Ç–µ–∫—Å—Ç–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 90¬∞).

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ—Å—å –Ω–∞–π–¥–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç (OCR).

–û–±—Ä–∞–±–æ—Ç–∫–∞ (Python):

–ü–æ–≤–æ—Ä–æ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö Google.

Smart Crop: –ï—Å–ª–∏ —Ç–µ–∫—Å—Ç –∑–∞–Ω–∏–º–∞–µ—Ç –æ—Ç 20% –¥–æ 90% –ª–∏—Å—Ç–∞ ‚Äî –æ–±—Ä–µ–∑–∞–µ–º –ª–∏—à–Ω–∏–π —Ñ–æ–Ω (—Å—Ç–æ–ª). –ï—Å–ª–∏ <20% (—à—Ç–∞–º–ø) –∏–ª–∏ >90% (—Å–∫–∞–Ω) ‚Äî –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å.

–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è (AI Hybrid):

–ï—Å–ª–∏ –µ—Å—Ç—å OCR-—Ç–µ–∫—Å—Ç -> –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ OpenAI —Ç–µ–∫—Å—Ç (–±—ã—Å—Ç—Ä–æ, –¥–µ—à–µ–≤–æ, –±–µ–∑ —Ü–µ–Ω–∑—É—Ä—ã).

–ï—Å–ª–∏ —Ç–µ–∫—Å—Ç–∞ –Ω–µ—Ç -> –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–∏–Ω–∫—É (fallback).

OpenAI –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON: {"doc_type": "Passport", "person_name": "Ivanov Ivan"}.

–ó–∞–≥—Ä—É–∑–∫–∞:

–§–∞–π–ª—ã —É–ª–µ—Ç–∞—é—Ç –≤ –æ–±–ª–∞–∫–æ: /Clients/{Phone}/{Name}/{Date}_{Type}.pdf

–§–∏–Ω–∞–ª: –ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é.

---

## üîÑ CI/CD (GitHub Actions)
–ü—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è (deploy.yml) –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:

–û–ø—Ä–µ–¥–µ–ª—è–µ—Ç –≤–µ—Ç–∫—É (main –∏–ª–∏ develop).

–ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –ø–æ SSH –∫ —Å–µ—Ä–≤–µ—Ä—É.

–î–µ–∫–æ–¥–∏—Ä—É–µ—Ç –∫–ª—é—á Google –∏–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤ GitHub (base64 -d) –∏ —Å–æ–∑–¥–∞–µ—Ç —Ñ–∞–π–ª google_credentials.json.

–°–æ–∑–¥–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã–π .env.

–ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ—Ç Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã.

---

## üöë –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã
–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏ (–≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏):
# Production
docker logs -f --tail 100 lawbot_app

# Test
docker logs -f --tail 100 lawbot_app_test

–ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞:
docker-compose up -d --build --force-recreate

---

### –ß—Ç–æ —è –æ–±–Ω–æ–≤–∏–ª:
1.  **Logic:** –ó–∞–º–µ–Ω–∏–ª "–º–µ—Ç–æ–¥ –¶–∏—Ñ–µ—Ä–±–ª–∞—Ç" –Ω–∞ **Google Vision Analysis**.
2.  **AI:** –î–æ–±–∞–≤–∏–ª –æ–ø–∏—Å–∞–Ω–∏–µ **–ì–∏–±—Ä–∏–¥–Ω–æ–≥–æ –º–µ—Ç–æ–¥–∞** (Text vs Image) –¥–ª—è –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ –ø–∞—Å–ø–æ—Ä—Ç–æ–≤.
3.  **Features:** –î–æ–±–∞–≤–∏–ª "Smart Crop —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –¥—É—Ä–∞–∫–∞".
4.  **Secrets:** –î–æ–±–∞–≤–∏–ª –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø—Ä–æ `google_credentials.json` –∏ Base64 –≤ GitHub Secrets.
5.  **Dependencies:** –£–∫–∞–∑–∞–ª –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –≤ —Å—Ç–µ–∫–µ.
---